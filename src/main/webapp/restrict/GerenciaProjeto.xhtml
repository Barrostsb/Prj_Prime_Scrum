<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/template/Layout.xhtml">


	<f:metadata>
		<f:viewAction action="#{tarefaController.buscarTodasTarefa}" />
	</f:metadata>


	<ui:define name="content">
		<p:panel id="prjHeader" header="Projeto">
			<h:outputText id="prjId"
				value="#{projetoController.projetoSelecionado.nome}" />
		</p:panel>

		<p:tabView id="tbvGerenciaDeProjeto">
			<p:tab title="Dados Projeto">

			</p:tab>


			<p:tab title="BackLog">


				<p:fieldset title="Novo requisito">

					<h:form prependId="false" id="formTask">
						<p:growl id="msg0" />
						<h:panelGrid columns="2" cellpadding="10" styleClass="panelGrid"
							id="grid0">
							<h:outputLabel />

							<h:inputHidden id="idTarefa"
								value="#{tarefaController.tarefa.id_tarefa}" />

							<h:outputLabel for="nomeTarefa" value="Nome.:" />

							<p:inputText id="nomeTarefa" size="40"
								value="#{tarefaController.tarefa.nome}"
								onkeyup="this.value = this.value.toUpperCase()" required="true"
								requiredMessage="O Campo Nome é Obrigatório!">
							</p:inputText>

							<p:panel>
								<p:commandButton value="Salvar"
									action="#{tarefaController.salvar}"
									image="ui-icon ui-icon-disk"
									actionListener="#{tarefaController.setProj}"
									update=":tbvGerenciaDeProjeto:formTask :tbvGerenciaDeProjeto:formListaRequisitos :tbvGerenciaDeProjeto:taskBoardForm">
									<!--   <f:attribute name="projeto" value="#{projetoController.projetoSelecionado}" />-->
								</p:commandButton>

								<p:commandButton value="Cancelar"
									actionListener="#{tarefaController.clear}"
									image="ui-icon ui-icon-close"
									update=":tbvGerenciaDeProjeto:formTask">
								</p:commandButton>
							</p:panel>
						</h:panelGrid>
					</h:form>

				</p:fieldset>


				<p:fieldset title="Requisitos">

					<h:form id="formListaRequisitos">

						<p:dataGrid var="tarefa"
							value="#{tarefaController.tarefaPorProjeto}" columns="3"
							rows="12" paginator="true"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="9,12,15">

							<p:panel header="#{tarefa.nome}" style="text-align:center">
								<h:panelGrid columns="3" style="width:100%">

									<p:commandButton
										update=":tbvGerenciaDeProjeto:formListaRequisitos:dialog"
										icon="ui-icon-search" title="View"
										oncomplete="PF('dlgDadostarefa').show();">
										<f:setPropertyActionListener value="#{tarefa}"
											target="#{tarefaController.tarefaSelecionada}" />
									</p:commandButton>

									<p:growl id="grow" showDetail="true" />

									<p:commandButton icon="ui-icon-closethick"
										actionListener="#{tarefaController.deletar}" update="grow">
										<f:attribute name="projetoSelecionada" value="#{tarefa}" />
										<p:confirm header="Confirmação"
											message="Deseja realmente excluir esta tarefa?"
											icon="ui-icon-alert" />

										<p:confirmDialog global="true" showEffect="fade"
											hideEffect="explode">
											<p:commandButton value="Sim" type="button"
												styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
											<p:commandButton value="Não" type="button"
												styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
										</p:confirmDialog>
									</p:commandButton>
									<!--  <p:commandLink update=":form:carDetail"
											oncomplete="PF('carDialog').show()" title="View Detail">
											<h:outputText styleClass="ui-icon ui-icon-search"
												style="margin:0 auto;" />
											<f:setPropertyActionListener value="#{tarefa}"
												target="#{tarefaController.tarefaSelecionada}" />
										</p:commandLink>
										-->
								</h:panelGrid>
							</p:panel>

						</p:dataGrid>

						<p:dialog id="dialog" widgetVar="dlgDadostarefa" showEffect="clip"
							hideEffect="clip" modal="true" appendTo="@(body)" width = "350" height = "250">

							<p:outputPanel id="detail" style="text-align:center;"
								layout="block">

								<h:panelGrid columns="2" cellpadding="5"
									rendered="#{not empty projetoController.projetoSelecionado}">

									<h:outputText value="Nome: " />
									<h:outputText id="trfNome"
										value="#{tarefaController.tarefaSelecionada.nome}" />


									<h:outputText value="Prioridade:" />
									<p:rating
										value="#{tarefaController.tarefaSelecionada.prioridade}" />


									<h:outputText value="Dificuldade:" />
									<h:panelGrid columns="1" style="margin-bottom:10px">
										<p:inputText id="txtDificuldade"
											value="#{tarefaController.tarefaSelecionada.dificuldade}" />
										<p:slider for="txtDificuldade" step="10" />
									</h:panelGrid>

									<h:outputLabel for="spinnerStep" value="Tempo de Execução: " />
									
									<p:spinner id="spinnerStep" value="#{tarefaController.tarefaSelecionada.tempo_execucao}" stepFactor="0.5" prefix="Dias: " min="0" />
										
								</h:panelGrid>
									<p:commandButton value="Alterar Dados" 
									 image="ui-icon-check"  
									 action="#{tarefaController.atualizarDados}"
									 immediate="true" process="@this"/>
							</p:outputPanel>

						</p:dialog>
					</h:form>
				</p:fieldset>



			</p:tab>
			<p:tab title="Sprints">
			</p:tab>


			<p:tab title="TaskBoard">
				<h:form id="taskBoardForm">
					<h:panelGrid columns="3" styleClass="panelGrid" id="gridMain">
						<p:fieldset id="todoColumn" legend="TO DO">

							<p:outputPanel id="dropAreaTodo">

								<p:dataGrid id="todoGrid" var="tarefa"
									value="#{taskBoardController.tarefasTodo}" columns="3"
									style="width:33%">

									<p:column>
										<p:panel id="pnl" header="#{tarefa.nome}"
											style="text-align:center">
											<p:draggable for="pnl" opacity="0.5" revert="true"
												handle=".ui-panel-titlebar" stack=".ui-panel" scope="doing" />
										</p:panel>
									</p:column>

								</p:dataGrid>

							</p:outputPanel>

						</p:fieldset>

						<p:fieldset id="inprocessColumn" legend="In Process">

							<p:outputPanel id="dropAreaInprocess">

								<p:dataGrid id="inprocessGrid" var="tarefa"
									value="#{taskBoardController.tarefasInprocess}" columns="3"
									style="width:33%">

									<p:column>
										<p:panel id="pnl" header="#{tarefa.nome}"
											style="text-align:center">
											<p:draggable for="pnl" revert="true"
												handle=".ui-panel-titlebar" stack=".ui-panel" scope="done" />
										</p:panel>
									</p:column>

								</p:dataGrid>

							</p:outputPanel>

						</p:fieldset>

						<p:fieldset id="doneColumn" legend="Done !">

							<p:outputPanel id="dropAreaDone">

								<p:dataGrid id="doneGrid" var="tarefa"
									value="#{taskBoardController.tarefasDone}" columns="3"
									style="width:33%">

									<p:column>
										<p:panel id="pnl" header="#{tarefa.nome}"
											style="text-align:center">
											<p:draggable for="pnl" revert="true"
												handle=".ui-panel-titlebar" stack=".ui-panel" scope="todo" />
										</p:panel>
									</p:column>

								</p:dataGrid>

							</p:outputPanel>

						</p:fieldset>

						<p:droppable for="dropAreaTodo" tolerance="touch"
							activeStyleClass="ui-state-highlight" datasource="doneGrid"
							scope="todo">
							<p:ajax listener="#{taskBoardController.onDropTodo}"
								update="taskBoardForm" />
						</p:droppable>

						<p:droppable for="dropAreaInprocess" tolerance="touch"
							activeStyleClass="ui-state-highlight" datasource="todoGrid"
							scope="doing">
							<p:ajax listener="#{taskBoardController.onDropDoing}"
								update="taskBoardForm" />
						</p:droppable>

						<p:droppable for="dropAreaDone" tolerance="touch"
							activeStyleClass="ui-state-highlight" datasource="inprocessGrid"
							scope="done">
							<p:ajax listener="#{taskBoardController.onDropDone}"
								update="taskBoardForm :tbvGerenciaDeProjeto:burndownForm" />
						</p:droppable>
					</h:panelGrid>
				</h:form>

			</p:tab>
			<p:tab title="Burndown">
				<h:form id="burndownForm">
					<p:lineChart value="#{burndownController.burnDownChart}"
						legendPosition="e" zoom="true" animate="true"
						title="Burndown Chart"
						style="width:100%; height:100%; text-align:center;" />
				</h:form>

			</p:tab>
		</p:tabView>
	</ui:define>
</ui:composition>